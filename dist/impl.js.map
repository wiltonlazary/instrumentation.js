{"version":3,"sources":["../src/impl.ts"],"names":[],"mappings":"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","file":"impl.js","sourcesContent":["import { ObjectProxyHandler } from './proxy_handler';\nimport { BinderConsumerType, Binder, currentBinderDispatchDetail, bypassNextBinderDispatch, abortNextBinderDispatch } from './binder'\n\nimport {\n    BindInParamsType, BindOutParamsType, getHeadPrototype, getHeadPrototypeFromInstance,\n    getPropertyDescriptorPrototype, getPropertyDescriptorPrototypeFromInstance, Instrumentation, ABORT_ACTION\n} from './instrumentation'\n\ndeclare const global: any\n\nif (!global) {\n    if (self) {\n        self['global'] = self\n    } else {\n        window['global'] = window\n    }\n}\n\nglobal.ABORT_ACTION = ABORT_ACTION\nglobal.ObjectProxyHandler = ObjectProxyHandler\nglobal.abortNextBinderDispatch = abortNextBinderDispatch\nglobal.bypassNextBinderDispatch = bypassNextBinderDispatch\nglobal.currentBinderDispatchDetail = currentBinderDispatchDetail\nglobal.getHeadPrototype = getHeadPrototype\nglobal.getHeadPrototypeFromInstance = getHeadPrototypeFromInstance\nglobal.getPropertyDescriptorPrototype = getPropertyDescriptorPrototype\nglobal.getPropertyDescriptorPrototypeFromInstance = getPropertyDescriptorPrototypeFromInstance\n\nif (Object.getOwnPropertyDescriptor(Object.prototype, 'instrumentation') === undefined) {\n    Object.defineProperty(Object.prototype, 'instrumentation', {\n        enumerable: false,\n        configurable: false,\n        get: function () {\n            if (Object.getOwnPropertyDescriptor(this, '__instrumentation') === undefined) {\n                let __instrumentation = new Instrumentation(this)\n\n                Object.defineProperty(this, '__instrumentation', {\n                    enumerable: false,\n                    configurable: false,\n                    get: function () {\n                        return __instrumentation\n                    },\n                    set: function (value) {\n                        __instrumentation = value\n                    }\n                })\n            }\n\n            return this.__instrumentation\n        },\n        set: function (value) {\n            this.__instrumentation = value\n        }\n    })\n}\n\nfunction defineObjectMethod(name: string, value: any) {\n    Object.defineProperty(Object.prototype, name, {\n        enumerable: false,\n        configurable: false,\n        value: value\n    })\n}\n\ndefineObjectMethod('dispose', function () {\n    if (this.isProxy) {\n        this.proxyHandler.dispose()\n    }\n\n    if (this.__instrumentation !== undefined) {\n        this.__instrumentation.dispose()\n        this.__instrumentation = undefined\n    }\n})\n\n\ndefineObjectMethod('bindOut', function (...params): Binder | Array<Binder> {\n    const instrumentation = this.instrumentation\n    let result = null\n\n    if (params.length === 1) {\n        const arr = params[0]\n        result = []\n\n        if (arr.length > 0) {\n            if (arr[0] instanceof Array) {\n                arr.forEach((element) => {\n                    if (element.length === 2) {\n                        result.push(instrumentation.bindOut(element[0], element[1]))\n                    } if (element.length === 3) {\n                        if (typeof element[1] === 'function') {\n                            result.push(instrumentation.bindOut(element[0], element[1], undefined, element[2]))\n                        } else {\n                            result.push(instrumentation.bindOut(element[0], element[1], element[2]))\n                        }\n                    } else if (element.length === 4) {\n                        result.push(instrumentation.bindOut(element[0], element[1], element[2], element[3]))\n                    }\n                })\n            } else {\n                result.push(instrumentation.bindOut(arr[0], arr[1], arr[2], arr[3]))\n            }\n        }\n    } else if (params.length > 1) {\n        result = instrumentation.bindOut(params[0], params[1], params[2], params[3])\n    }\n\n    return result\n})\n\nfunction bindInProcessor(self: any, element: Array<any>, storage?: Array<any>): Binder {\n    let result: Binder = undefined\n\n    if (element.length === 3) {\n        if (typeof element[2] === 'function') {\n            result = element[0].bindOut(element[1], element[2])\n        } else {\n            result = element[0].bindOut(element[1], self, element[2])\n        }\n    } else if (element.length === 4) {\n        if (typeof element[2] === 'function') {\n            result = element[0].bindOut(element[1], element[2], undefined, element[3])\n        } else {\n            result = element[0].bindOut(element[1], self, element[2], element[3])\n        }\n    }\n\n    if (storage && result) {\n        storage.push(result)\n    }\n\n    return result\n}\n\ndefineObjectMethod('bindIn', function (...params): Binder | Array<Binder> {\n    let result = null\n\n    if (params.length === 1) {\n        const arr = params[0]\n        result = []\n\n        if (arr.length > 0) {\n            if (arr[0] instanceof Array) {\n                arr.forEach((element) => {\n                    bindInProcessor(this, element, result)\n                })\n            } else {\n                bindInProcessor(this, arr, result)\n            }\n        }\n    } else if (params.length > 1) {\n        result = bindInProcessor(this, params)\n    }\n\n    return this\n})\n\ndefineObjectMethod('toProxy', function (): any {\n    if (this.isProxy) {\n        return this\n    } else {\n        return ObjectProxyHandler.create(this)\n    }\n})\n"]}