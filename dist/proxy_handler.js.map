{"version":3,"sources":["../src/proxy_handler.ts"],"names":[],"mappings":";;AAAa,QAAA,cAAc,GAAG;IAC1B,MAAM,EAAE,CAAC,KAAU,EAAE,QAAa,EAAE,SAAiB,EAAE,IAAwB,EAAE,EAAE;QAC/E,OAAO,CAAC,GAAG,CAAC,qCAAqC,SAAS,UAAU,IAAI,CAAC,SAAS,CAAC,IAAI,CAAC,IAAI,CAAC,GAAG,CAAC,CAAC,aAAa,IAAI,CAAC,SAAS,CAAC,QAAQ,CAAC,UAAU,IAAI,CAAC,SAAS,CAAC,KAAK,CAAC,EAAE,CAAC,CAAA;IAC7K,CAAC;CACJ,CAAA;AAED,MAAM,6BAA6B,GAAuB;IACtD,GAAG,EAAE,cAAc,MAAM,CAAC,IAAI,CAAA,CAAC,CAAC;IAChC,UAAU,EAAE,KAAK;IACjB,YAAY,EAAE,KAAK;CACtB,CAAA;AAED;IA4BI,YAA4B,OAAY,EAAS,QAAa,EAAS,WAAwB;QAAnE,YAAO,GAAP,OAAO,CAAK;QAAS,aAAQ,GAAR,QAAQ,CAAK;QAAS,gBAAW,GAAX,WAAW,CAAa;QA3B/F,kBAAa,GAAG,KAAK,CAAA;QACrB,kBAAa,GAAQ,IAAI,CAAA;QA2BrB,IAAI,CAAC,aAAa,GAAG,QAAQ,YAAY,GAAG,CAAA;IAChD,CAAC;IA1BD,MAAM,CAAC,MAAM,CAAC,OAAY,EAAE,WAAgB,IAAI,EAAE,cAA2B,IAAI;QAC7E,IAAI,YAAY,GAAG,IAAI,CAAA;QAEvB,EAAE,CAAC,CAAC,KAAK,CAAC,OAAO,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC;YACzB,YAAY,GAAG,IAAI,iBAAiB,CAAC,OAAO,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAA;QACxE,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,OAAO,YAAY,GAAG,CAAC,CAAC,CAAC;YAChC,YAAY,GAAG,IAAI,eAAe,CAAC,OAAO,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAA;QACtE,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,YAAY,GAAG,IAAI,kBAAkB,CAAC,OAAO,EAAE,QAAQ,EAAE,WAAW,CAAC,CAAA;QACzE,CAAC;QAED,MAAM,KAAK,GAAG,IAAI,KAAK,CAAC,OAAO,EAAE,YAAY,CAAC,CAAA;QAC9C,MAAM,CAAC,cAAc,CAAC,KAAK,EAAE,SAAS,EAAE,6BAA6B,CAAC,CAAA;QAEtE,MAAM,CAAC,cAAc,CAAC,KAAK,EAAE,cAAc,EAAE;YACzC,GAAG,EAAE,cAAc,MAAM,CAAC,YAAY,CAAA,CAAC,CAAC;YACxC,UAAU,EAAE,KAAK;YACjB,YAAY,EAAE,KAAK;SACtB,CAAC,CAAA;QAEF,YAAY,CAAC,aAAa,GAAG,KAAK,CAAA;QAClC,MAAM,CAAC,KAAK,CAAA;IAChB,CAAC;IAMD,IAAI,cAAc;QACd,MAAM,CAAC,IAAI,CAAA;IACf,CAAC;IAED,WAAW,CAAC,QAAa,EAAE,WAAwB;QAC/C,EAAE,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YACjB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAA;YACxB,IAAI,CAAC,WAAW,GAAG,WAAW,CAAA;QAClC,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YAC5B,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,QAAQ,EAAE,WAAW,CAAC,CAAA;QAC5C,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,CAAC;YACpC,IAAI,CAAC,QAAQ,GAAG,IAAI,GAAG,EAAE,CAAA;YACzB,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAC,IAAI,CAAC,QAAQ,EAAE,IAAI,CAAC,WAAW,CAAC,CAAA;YAClD,IAAI,CAAC,aAAa,GAAG,IAAI,CAAA;YACzB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAA;QAC3B,CAAC;IACL,CAAC;IAED,cAAc,CAAC,QAAa;QACxB,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;YACrB,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,QAAQ,CAAC,CAAA;YAE9B,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;gBAC3B,IAAI,CAAC,aAAa,GAAG,KAAK,CAAA;gBAC1B,MAAM,GAAG,GAAG,IAAI,CAAC,QAAQ,CAAA;gBAEzB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,OAAO,EAAE,EAAE;oBAC3C,IAAI,CAAC,QAAQ,GAAG,OAAO,CAAA;oBACvB,IAAI,CAAC,WAAW,GAAG,WAAW,CAAA;gBAClC,CAAC,CAAC,CAAA;gBAEF,GAAG,CAAC,KAAK,EAAE,CAAA;YACf,CAAC;YAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,KAAK,CAAC,CAAC,CAAC,CAAC;gBAClC,IAAI,CAAC,aAAa,GAAG,KAAK,CAAA;gBAC1B,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAA;gBACpB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAA;YAC3B,CAAC;QACL,CAAC;QAAC,IAAI,CAAC,EAAE,CAAC,CAAC,IAAI,CAAC,QAAQ,KAAK,QAAQ,CAAC,CAAC,CAAC;YACpC,IAAI,CAAC,QAAQ,GAAG,IAAI,CAAA;YACpB,IAAI,CAAC,WAAW,GAAG,IAAI,CAAA;QAC3B,CAAC;IACL,CAAC;IAED,MAAM,CAAC,KAAU,EAAE,QAAa,EAAE,SAAiB,EAAE,IAAwB;QACzE,EAAE,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;YAClB,EAAE,CAAC,CAAC,IAAI,CAAC,aAAa,CAAC,CAAC,CAAC;gBACrB,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAC,CAAC,WAAW,EAAE,OAAO,EAAE,EAAE;oBAC3C,IAAI,CAAC,OAAO,CAAC,WAAW,CAAC,CAAA;oBACzB,OAAO,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,CAAA;oBAChD,IAAI,CAAC,KAAK,EAAE,CAAA;gBAChB,CAAC,CAAC,CAAA;YACN,CAAC;YAAC,IAAI,CAAC,CAAC;gBACJ,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,WAAW,CAAC,CAAA;gBAC9B,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE,SAAS,EAAE,IAAI,CAAC,CAAA;YAC1D,CAAC;QACL,CAAC;IACL,CAAC;IAED,GAAG,CAAC,MAAS,EAAE,CAAc,EAAE,QAAa;QACxC,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;QAE3B,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,YAAY,MAAM,CAAC,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC;YACtE,MAAM,CAAC,KAAK,CAAA;QAChB,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,KAAK,GAAG,kBAAkB,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,EAAE,CAAC,CAAC,CAAA;YACjD,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,KAAK,CAAA;YACvB,MAAM,CAAC,KAAK,CAAA;QAChB,CAAC;IACL,CAAC;IAED,GAAG,CAAC,MAAS,EAAE,CAAc,EAAE,KAAU,EAAE,QAAa;QACpD,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;QAChC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,GAAG,KAAK,CAAA;QACvB,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,CAAC,CAAC,CAAC,CAAA;QACxC,MAAM,CAAC,IAAI,CAAA;IACf,CAAC;IAED,cAAc,CAAC,MAAS,EAAE,CAAc;QACpC,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;QAChC,OAAO,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;QACtB,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,CAAC,CAAC,CAAC,CAAA;QAC/C,MAAM,CAAC,IAAI,CAAA;IACf,CAAC;CACJ;AAnHD,gDAmHC;AAED,uBAAiD,SAAQ,kBAAqB;IAA9E;;QACI,YAAO,GAAG,IAAI,CAAA;QACd,cAAS,GAAG,IAAI,CAAA;IAyDpB,CAAC;IAvDG,IAAI,QAAQ;QACR,MAAM,IAAI,GAAG,IAAI,CAAA;QAEjB,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,CAAC,CAAC;YAC1B,IAAI,CAAC,SAAS,GAAG;gBACb,IAAI,EAAE,CAAC,OAAO,EAAU,EAAE;oBACtB,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,OAAO,CAAC,CAAA;oBACtC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,SAAS,EAAE,MAAM,EAAE,CAAC,GAAG,GAAG,CAAC,CAAC,CAAC,CAAA;oBAClD,MAAM,CAAC,GAAG,CAAA;gBACd,CAAC;gBACD,GAAG,EAAE,GAAQ,EAAE;oBACX,MAAM,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,GAAG,CAAC,CAAA;oBACrC,MAAM,QAAQ,GAAG,KAAK,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,KAAK,CAAC,CAAC,CAAC,CAAC,SAAS,CAAA;oBAC7D,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,EAAE,CAAA;oBAC9B,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,KAAK,CAAC,CAAC,CAAA;oBAChD,MAAM,CAAC,GAAG,CAAA;gBACd,CAAC;gBACD,OAAO,EAAE,CAAC,OAAO,EAAU,EAAE;oBACzB,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAA;oBACvE,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,OAAO,CAAC,OAAO,CAAC,CAAA;oBACzC,IAAI,CAAC,MAAM,CAAC,OAAO,EAAE,QAAQ,EAAE,SAAS,EAAE,CAAC,CAAC,CAAC,CAAC,CAAA;oBAC9C,MAAM,CAAC,GAAG,CAAA;gBACd,CAAC;gBACD,KAAK,EAAE,GAAQ,EAAE;oBACb,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,CAAA;oBACvE,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAA;oBAChC,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,OAAO,CAAC,MAAM,IAAI,CAAC,CAAC,CAAC,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC,SAAS,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,CAAC,CAAC,CAAC,CAAA;oBAC3F,MAAM,CAAC,GAAG,CAAA;gBACd,CAAC;aACJ,CAAA;QACL,CAAC;QAED,MAAM,CAAC,IAAI,CAAC,SAAS,CAAA;IACzB,CAAC;IAED,GAAG,CAAC,MAAS,EAAE,CAAc,EAAE,QAAa;QACxC,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;QAE3B,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,UAAU,CAAC,CAAC,CAAC;YAC9B,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACR,KAAK,MAAM;oBACP,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,IAAI,CAAA;gBAC7B,KAAK,KAAK;oBACN,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAA;gBAC5B,KAAK,OAAO;oBACR,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAA;gBAC9B,KAAK,SAAS;oBACV,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAA;gBAChC;oBACI,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAA;YAC7C,CAAC;QACL,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAA;QACzC,CAAC;IACL,CAAC;CACJ;AA3DD,8CA2DC;AAED;IACI,YAA4B,UAAe,EAAkB,OAAY,EAAkB,QAAa;QAA5E,eAAU,GAAV,UAAU,CAAK;QAAkB,YAAO,GAAP,OAAO,CAAK;QAAkB,aAAQ,GAAR,QAAQ,CAAK;IAExG,CAAC;IAED,CAAC,MAAM,CAAC,QAAQ,CAAC;QACb,MAAM,CAAC,IAAI,CAAA;IACf,CAAC;IAED,IAAI,CAAC,KAAW;QACZ,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAA;QAE/B,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;YACb,MAAM,CAAC,KAAK,CAAA;QAChB,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,IAAI,UAAU,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;YAE/B,EAAE,CAAC,CAAC,UAAU,YAAY,MAAM,CAAC,CAAC,CAAC;gBAC/B,EAAE,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;oBACrB,MAAM,YAAY,GAAG,UAAU,CAAC,YAAY,CAAA;oBAE5C,EAAE,CAAC,CAAC,YAAY,CAAC,QAAQ,KAAK,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;wBAC1C,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;oBAC3C,CAAC;gBACL,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,MAAM,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;oBAC1B,MAAM,QAAQ,GAAG,kBAAkB,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAA;oBAC1E,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,QAAQ,CAAC,CAAA;oBAElC,KAAK,GAAG;wBACJ,IAAI,EAAE,KAAK,CAAC,IAAI;wBAChB,KAAK,EAAE,CAAC,GAAG,EAAE,QAAQ,CAAC;qBACzB,CAAA;gBACL,CAAC;YACL,CAAC;YAED,MAAM,CAAC,KAAK,CAAA;QAChB,CAAC;IACL,CAAC;CACJ;AAvCD,wEAuCC;AAED;IACI,YAA4B,UAAe,EAAkB,OAAY,EAAkB,QAAa;QAA5E,eAAU,GAAV,UAAU,CAAK;QAAkB,YAAO,GAAP,OAAO,CAAK;QAAkB,aAAQ,GAAR,QAAQ,CAAK;IAExG,CAAC;IAED,CAAC,MAAM,CAAC,QAAQ,CAAC;QACb,MAAM,CAAC,IAAI,CAAA;IACf,CAAC;IAED,IAAI,CAAC,KAAW;QACZ,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,IAAI,EAAE,CAAA;QAE/B,EAAE,CAAC,CAAC,KAAK,CAAC,IAAI,CAAC,CAAC,CAAC;YACb,MAAM,CAAC,KAAK,CAAA;QAChB,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,MAAM,GAAG,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;YAC1B,IAAI,UAAU,GAAG,KAAK,CAAC,KAAK,CAAC,CAAC,CAAC,CAAA;YAE/B,EAAE,CAAC,CAAC,UAAU,YAAY,MAAM,CAAC,CAAC,CAAC;gBAC/B,EAAE,CAAC,CAAC,UAAU,CAAC,OAAO,CAAC,CAAC,CAAC;oBACrB,MAAM,YAAY,GAAG,UAAU,CAAC,YAAY,CAAA;oBAE5C,EAAE,CAAC,CAAC,YAAY,CAAC,QAAQ,KAAK,IAAI,CAAC,QAAQ,CAAC,CAAC,CAAC;wBAC1C,YAAY,CAAC,WAAW,CAAC,IAAI,CAAC,QAAQ,CAAC,CAAA;oBAC3C,CAAC;gBACL,CAAC;gBAAC,IAAI,CAAC,CAAC;oBACJ,UAAU,GAAG,kBAAkB,CAAC,MAAM,CAAC,UAAU,EAAE,IAAI,CAAC,QAAQ,EAAE,GAAG,CAAC,CAAA;oBACtE,IAAI,CAAC,UAAU,CAAC,GAAG,CAAC,GAAG,EAAE,UAAU,CAAC,CAAA;gBACxC,CAAC;YACL,CAAC;YAED,MAAM,CAAC;gBACH,IAAI,EAAE,KAAK,CAAC,IAAI;gBAChB,KAAK,EAAE,UAAU;aACpB,CAAA;QACL,CAAC;IACL,CAAC;CACJ;AArCD,sEAqCC;AAED,qBAA+C,SAAQ,kBAAqB;IAA5E;;QACI,UAAK,GAAG,IAAI,CAAA;QACZ,cAAS,GAAG,IAAI,CAAA;IAsFpB,CAAC;IApFG,IAAI,QAAQ;QACR,MAAM,IAAI,GAAG,IAAI,CAAA;QAEjB,EAAE,CAAC,CAAC,IAAI,CAAC,SAAS,KAAK,IAAI,CAAC,CAAC,CAAC;YAC1B,IAAI,CAAC,SAAS,GAAG;gBACb,GAAG,EAAE,CAAC,GAAG,EAAO,EAAE;oBACd,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;oBAEjC,EAAE,CAAC,CAAC,CAAC,CAAC,KAAK,YAAY,MAAM,CAAC,IAAI,KAAK,CAAC,OAAO,IAAI,KAAK,CAAC,cAAc,CAAC,CAAC,CAAC;wBACtE,MAAM,CAAC,KAAK,CAAA;oBAChB,CAAC;oBAAC,IAAI,CAAC,CAAC;wBACJ,KAAK,GAAG,kBAAkB,CAAC,MAAM,CAAC,KAAK,EAAE,IAAI,EAAE,GAAG,CAAC,CAAA;wBACnD,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAA;wBAC5B,MAAM,CAAC,KAAK,CAAA;oBAChB,CAAC;gBACL,CAAC;gBACD,GAAG,EAAE,CAAC,GAAG,EAAE,KAAK,EAAO,EAAE;oBACrB,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;oBACtC,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,EAAE,KAAK,CAAC,CAAA;oBACxC,IAAI,CAAC,MAAM,CAAC,KAAK,EAAE,QAAQ,EAAE,KAAK,EAAE,CAAC,GAAG,CAAC,CAAC,CAAA;oBAC1C,MAAM,CAAC,GAAG,CAAA;gBACd,CAAC;gBACD,MAAM,EAAE,CAAC,GAAG,EAAO,EAAE;oBACjB,MAAM,QAAQ,GAAG,IAAI,CAAC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAA;oBACtC,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,MAAM,CAAC,GAAG,CAAC,CAAA;oBACpC,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE,QAAQ,EAAE,CAAC,GAAG,CAAC,CAAC,CAAA;oBACjD,MAAM,CAAC,GAAG,CAAA;gBACd,CAAC;gBACD,OAAO,EAAE,GAAmC,EAAE;oBAC1C,MAAM,CAAC,IAAI,8BAA8B,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,IAAI,CAAC,CAAA;gBACzF,CAAC;gBACD,MAAM,EAAE,GAAkC,EAAE;oBACxC,MAAM,CAAC,IAAI,6BAA6B,CAAC,IAAI,CAAC,OAAO,EAAE,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,EAAE,IAAI,CAAC,CAAA;gBACxF,CAAC;gBACD,KAAK,EAAE,GAAQ,EAAE;oBACb,MAAM,QAAQ,GAAG,EAAE,CAAA;oBAEnB,GAAG,CAAC,CAAC,MAAM,EAAE,IAAI,IAAI,CAAC,OAAO,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;wBACtC,QAAQ,CAAC,IAAI,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,EAAE,EAAE,CAAC,CAAC,CAAC,YAAY,MAAM,IAAI,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,CAAA;oBAC5F,CAAC;oBAED,MAAM,GAAG,GAAG,IAAI,CAAC,OAAO,CAAC,KAAK,EAAE,CAAA;oBAChC,IAAI,CAAC,MAAM,CAAC,SAAS,EAAE,QAAQ,EAAE,OAAO,EAAE,CAAC,GAAG,CAAC,CAAC,CAAA;oBAChD,MAAM,CAAC,GAAG,CAAA;gBACd,CAAC;gBACD,OAAO,EAAE,CAAC,QAAQ,EAAE,OAAQ,EAAQ,EAAE;oBAClC,GAAG,CAAC,CAAC,MAAM,KAAK,IAAI,IAAI,CAAC,SAAS,CAAC,OAAO,EAAE,CAAC,CAAC,CAAC;wBAC3C,QAAQ,CAAC,IAAI,CAAC,OAAO,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,KAAK,CAAC,CAAC,CAAC,EAAE,IAAI,CAAC,aAAa,CAAC,CAAA;oBAClE,CAAC;gBACL,CAAC;aACJ,CAAA;QACL,CAAC;QAED,MAAM,CAAC,IAAI,CAAC,SAAS,CAAA;IACzB,CAAC;IAED,GAAG,CAAC,MAAS,EAAE,CAAc,EAAE,QAAa;QACxC,IAAI,KAAK,GAAG,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC,CAAA;QAE3B,EAAE,CAAC,CAAC,OAAO,KAAK,KAAK,UAAU,CAAC,CAAC,CAAC;YAC9B,MAAM,CAAC,CAAC,CAAC,CAAC,CAAC,CAAC;gBACR,KAAK,KAAK;oBACN,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAA;gBAC5B,KAAK,KAAK;oBACN,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,GAAG,CAAA;gBAC5B,KAAK,QAAQ;oBACT,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAA;gBAC/B,KAAK,SAAS;oBACV,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAA;gBAChC,KAAK,QAAQ;oBACT,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,MAAM,CAAA;gBAC/B,KAAK,OAAO;oBACR,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,KAAK,CAAA;gBAC9B,KAAK,MAAM,CAAC,QAAQ;oBAChB,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAA;gBAChC,KAAK,SAAS;oBACV,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,OAAO,CAAA;gBAChC;oBACI,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAA;YAC7C,CAAC;QACL,CAAC;QAAC,IAAI,CAAC,CAAC;YACJ,MAAM,CAAC,KAAK,CAAC,GAAG,CAAC,MAAM,EAAE,CAAC,EAAE,QAAQ,CAAC,CAAA;QACzC,CAAC;IACL,CAAC;CACJ;AAxFD,0CAwFC;AAID,MAAM,CAAC,kBAAkB,GAAG,kBAAkB,CAAA","file":"proxy_handler.js","sourcesContent":["export const loggerObserver = {\n    notify: (value: any, oldValue: any, operation: string, path: Array<PropertyKey>) => {\n        console.log(`loggerObserver.notify: operation=\"${operation}\" path=${JSON.stringify(path.join('.'))} oldValue=${JSON.stringify(oldValue)} value=${JSON.stringify(value)}`)\n    }\n}\n\nconst booleanTruePropertyDefinition: PropertyDescriptor = {\n    get: function () { return true },\n    enumerable: false,\n    configurable: false\n}\n\nexport class ObjectProxyHandler<T extends object> implements ProxyHandler<T> {\n    observerIsMap = false\n    proxyInstance: any = null\n\n    static create(backing: any, observer: any = null, propertyKey: PropertyKey = null): any {\n        let proxyHandler = null\n\n        if (Array.isArray(backing)) {\n            proxyHandler = new ArrayProxyHandler(backing, observer, propertyKey)\n        } else if (backing instanceof Map) {\n            proxyHandler = new MapProxyHandler(backing, observer, propertyKey)\n        } else {\n            proxyHandler = new ObjectProxyHandler(backing, observer, propertyKey)\n        }\n\n        const value = new Proxy(backing, proxyHandler)\n        Object.defineProperty(value, 'isProxy', booleanTruePropertyDefinition)\n\n        Object.defineProperty(value, 'proxyHandler', {\n            get: function () { return proxyHandler },\n            enumerable: false,\n            configurable: false\n        })\n\n        proxyHandler.proxyInstance = value\n        return value\n    }\n\n    constructor(public readonly backing: any, public observer: any, public propertyKey: PropertyKey) {\n        this.observerIsMap = observer instanceof Map\n    }\n\n    get isProxyHandler(): boolean {\n        return true\n    }\n\n    addObserver(observer: any, propertyKey: PropertyKey) {\n        if (!this.observer) {\n            this.observer = observer\n            this.propertyKey = propertyKey\n        } else if (this.observerIsMap) {\n            this.observer.set(observer, propertyKey)\n        } else if (this.observer !== observer) {\n            this.observer = new Map()\n            this.observer.set(this.observer, this.propertyKey)\n            this.observerIsMap = true\n            this.propertyKey = null\n        }\n    }\n\n    removeObserver(observer: any) {\n        if (this.observerIsMap) {\n            this.observer.delete(observer)\n\n            if (this.observer.size === 1) {\n                this.observerIsMap = false\n                const map = this.observer\n\n                this.observer.forEach((propertyKey, element) => {\n                    this.observer = element\n                    this.propertyKey = propertyKey\n                })\n\n                map.clear()\n            } else if (this.observer.size === 0) {\n                this.observerIsMap = false\n                this.observer = null\n                this.propertyKey = null\n            }\n        } else if (this.observer === observer) {\n            this.observer = null\n            this.propertyKey = null\n        }\n    }\n\n    notify(value: any, oldValue: any, operation: string, path: Array<PropertyKey>) {\n        if (!!this.observer) {\n            if (this.observerIsMap) {\n                this.observer.forEach((propertyKey, element) => {\n                    path.unshift(propertyKey)\n                    element.notify(value, oldValue, operation, path)\n                    path.shift()\n                })\n            } else {\n                path.unshift(this.propertyKey)\n                this.observer.notify(value, oldValue, operation, path)\n            }\n        }\n    }\n\n    get(target: T, p: PropertyKey, receiver: any): any {\n        let value = this.backing[p]\n\n        if (!(value instanceof Object) || value.isProxy || value.isProxyHandler) {\n            return value\n        } else {\n            value = ObjectProxyHandler.create(value, this, p)\n            this.backing[p] = value\n            return value\n        }\n    }\n\n    set(target: T, p: PropertyKey, value: any, receiver: any): boolean {\n        const oldValue = this.backing[p]\n        this.backing[p] = value\n        this.notify(value, oldValue, 'set', [p])\n        return true\n    }\n\n    deleteProperty(target: T, p: PropertyKey): boolean {\n        const oldValue = this.backing[p]\n        delete this.backing[p]\n        this.notify(undefined, oldValue, 'delete', [p])\n        return true\n    }\n}\n\nexport class ArrayProxyHandler<T extends object> extends ObjectProxyHandler<T> {\n    isArray = true\n    _handlers = null\n\n    get handlers(): any {\n        const self = this\n\n        if (this._handlers === null) {\n            this._handlers = {\n                push: (element): number => {\n                    const res = self.backing.push(element)\n                    self.notify(element, undefined, 'push', [res - 1])\n                    return res\n                },\n                pop: (): any => {\n                    const index = self.backing.length - 1\n                    const oldValue = index >= 0 ? self.backing[index] : undefined\n                    const res = self.backing.pop()\n                    self.notify(undefined, oldValue, 'pop', [index])\n                    return res\n                },\n                unshift: (element): number => {\n                    const oldValue = self.backing.length >= 1 ? self.backing[0] : undefined\n                    const res = self.backing.unshift(element)\n                    self.notify(element, oldValue, 'unshift', [0])\n                    return res\n                },\n                shift: (): any => {\n                    const oldValue = self.backing.length >= 1 ? self.backing[0] : undefined\n                    const res = self.backing.shift()\n                    self.notify(self.backing.length >= 1 ? self.backing[0] : undefined, oldValue, 'shift', [0])\n                    return res\n                }\n            }\n        }\n\n        return this._handlers\n    }\n\n    get(target: T, p: PropertyKey, receiver: any): any {\n        let value = this.backing[p]\n\n        if (typeof value === 'function') {\n            switch (p) {\n                case 'push':\n                    return this.handlers.push\n                case 'pop':\n                    return this.handlers.pop\n                case 'shift':\n                    return this.handlers.shift\n                case 'unshift':\n                    return this.handlers.unshift\n                default:\n                    return super.get(target, p, receiver)\n            }\n        } else {\n            return super.get(target, p, receiver)\n        }\n    }\n}\n\nexport class MapProxyHandlerEntriesIterator implements Iterable<[any, any]> {\n    constructor(public readonly backingMap: any, public readonly backing: any, public readonly observer: any) {\n\n    }\n\n    [Symbol.iterator](): IterableIterator<[any, any]> {\n        return this\n    }\n\n    next(value?: any): IteratorResult<[any, any]> {\n        let entry = this.backing.next()\n\n        if (entry.done) {\n            return entry\n        } else {\n            let valueLocal = entry.value[1]\n\n            if (valueLocal instanceof Object) {\n                if (valueLocal.isProxy) {\n                    const proxyHandler = valueLocal.proxyHandler\n\n                    if (proxyHandler.observer !== this.observer) {\n                        proxyHandler.addObserver(this.observer)\n                    }\n                } else {\n                    const key = entry.value[0]\n                    const newValue = ObjectProxyHandler.create(valueLocal, this.observer, key)\n                    this.backingMap.set(key, newValue)\n\n                    entry = {\n                        done: entry.done,\n                        value: [key, newValue]\n                    }\n                }\n            }\n\n            return entry\n        }\n    }\n}\n\nexport class MapProxyHandlerValuesIterator implements Iterable<any>{\n    constructor(public readonly backingMap: any, public readonly backing: any, public readonly observer: any) {\n\n    }\n\n    [Symbol.iterator](): IterableIterator<any> {\n        return this\n    }\n\n    next(value?: any): IteratorResult<any> {\n        let entry = this.backing.next()\n\n        if (entry.done) {\n            return entry\n        } else {\n            const key = entry.value[0]\n            let valueLocal = entry.value[1]\n\n            if (valueLocal instanceof Object) {\n                if (valueLocal.isProxy) {\n                    const proxyHandler = valueLocal.proxyHandler\n\n                    if (proxyHandler.observer !== this.observer) {\n                        proxyHandler.addObserver(this.observer)\n                    }\n                } else {\n                    valueLocal = ObjectProxyHandler.create(valueLocal, this.observer, key)\n                    this.backingMap.set(key, valueLocal)\n                }\n            }\n\n            return {\n                done: entry.done,\n                value: valueLocal\n            }\n        }\n    }\n}\n\nexport class MapProxyHandler<T extends object> extends ObjectProxyHandler<T> {\n    isMap = true\n    _handlers = null\n\n    get handlers(): any {\n        const self = this\n\n        if (this._handlers === null) {\n            this._handlers = {\n                get: (key): any => {\n                    let value = self.backing.get(key)\n\n                    if (!(value instanceof Object) || value.isProxy || value.isProxyHandler) {\n                        return value\n                    } else {\n                        value = ObjectProxyHandler.create(value, self, key)\n                        self.backing.set(key, value)\n                        return value\n                    }\n                },\n                set: (key, value): any => {\n                    const oldValue = self.backing.get(key)\n                    const res = self.backing.set(key, value)\n                    self.notify(value, oldValue, 'set', [key])\n                    return res\n                },\n                delete: (key): any => {\n                    const oldValue = self.backing.get(key)\n                    const res = self.backing.delete(key)\n                    this.notify(undefined, oldValue, 'delete', [key])\n                    return res\n                },\n                entries: (): MapProxyHandlerEntriesIterator => {\n                    return new MapProxyHandlerEntriesIterator(self.backing, self.backing.entries(), self)\n                },\n                values: (): MapProxyHandlerValuesIterator => {\n                    return new MapProxyHandlerValuesIterator(self.backing, self.backing.entries(), self)\n                },\n                clear: (): any => {\n                    const oldValue = []\n\n                    for (const el of self.backing.entries()) {\n                        oldValue.push([el[0], el[1] instanceof Object && el[1].isProxy ? el[1].backing : el[1]])\n                    }\n\n                    const res = self.backing.clear()\n                    this.notify(undefined, oldValue, 'clear', ['*'])\n                    return res\n                },\n                forEach: (callback, thisArg?): void => {\n                    for (const entry of self._handlers.entries()) {\n                        callback.call(thisArg, entry[1], entry[0], self.proxyInstance)\n                    }\n                }\n            }\n        }\n\n        return this._handlers\n    }\n\n    get(target: T, p: PropertyKey, receiver: any): any {\n        let value = this.backing[p]\n\n        if (typeof value === 'function') {\n            switch (p) {\n                case 'get':\n                    return this.handlers.get\n                case 'set':\n                    return this.handlers.set\n                case 'delete':\n                    return this.handlers.delete\n                case 'entries':\n                    return this.handlers.entries\n                case 'values':\n                    return this.handlers.values\n                case 'clear':\n                    return this.handlers.clear\n                case Symbol.iterator:\n                    return this.handlers.entries\n                case 'forEach':\n                    return this.handlers.forEach\n                default:\n                    return super.get(target, p, receiver)\n            }\n        } else {\n            return super.get(target, p, receiver)\n        }\n    }\n}\n\n//----------------------------------------------------------------------------------//\ndeclare const global: any\nglobal.ObjectProxyHandler = ObjectProxyHandler\n"]}